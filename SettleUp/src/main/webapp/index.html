<!DOCTYPE html>
<html lang="en"   xmlns:ng="http://angularjs.org">
<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
<script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js"></script>
<script type="text/javascript">
var appModule=angular.module("settleApp",[]);
appModule.controller("groupController", ['$scope','$http',function($scope,$http){
	$scope.init=function(){
		$scope.getGroups();		
		}
	$scope.getGroups=function(){		
		$http.get("rest/groups").then(
		function(response) {			
        $scope.status = response.status;
        $scope.groups = response.data.groups;
      }, function(response) {
        $scope.data = response.data || "Request failed";
        $scope.status = response.status;
    });	
	}	
	$scope.getGroupUsers=function(){
		alert($scope.groupId)
		$http.get("rest/users?groupId="+$scope.groupId).then(
				function(response) {			
		        $scope.status = response.status;
		        $scope.groupUsers = response.data.users;
		      }, function(response) {
		        $scope.data = response.data || "Request failed";
		        $scope.status = response.status;
		    });	
	}

$scope.addUser=function(){	
	var postData={groupId:$scope.groupId, users:[$scope.newUser]};
	alert(postData);
	$http.post("rest/user",postData).then(function(response){
		$scope.groupUsers.push($scope.newUser);
	},function(response){
		 $scope.data = response.data || "Request failed";
	        $scope.status = response.status;
	});
}
$scope.init();
}]);

</script>

<body style="margin:20px"  ng-app='settleApp' >

<div class="container" ng-controller="groupController" >
Groups  <select ng-model="groupId" ng-change="getGroupUsers()" >
<option ng-repeat="g in groups" value="{{g.groupId}}"  >{{g.groupName}}</option>
</select>
<!-- <button type="button" class="btn btn-info btn-md" ng-click="getGroups()">Get Groups</button> -->
<br/>
Search <input type="text" ng-model="search" style="margin:20px"/>
<table class="table table-striped table-bordered">
    <thead>
      <tr>
        <th>Name</th>
        <th>Email</th>
      </tr>
    </thead>
    <tbody>
      <tr ng-repeat="user in groupUsers | filter:search" >
        <td>{{user.name}}</td>
        <td>{{user.email}}</td>   
      </tr>      
    </tbody>
  </table>
  
<button type="button" class="btn btn-info btn-md" data-toggle="modal" data-target="#myModal">Add User</button>
<!-- Modal -->
<div id="myModal" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Add User</h4>
      </div>
      <div class="modal-body">
        <p><form role="form" name="newUser">
    <div class="form-group">
      <label for="name">Name</label>
      <input type="text" class="form-control" id="name" placeholder="Enter name" ng-model="newUser.name">
    </div>
    <div class="form-group">
      <label for="designation">Email</label>
      <input type="text" class="form-control" id="designation" placeholder="Enter Designation" ng-model="newUser.email">
    </div>	 
   
  </form></p>
      </div>
      <div class="modal-footer">
	   <button type="submit" class="btn btn-primary" data-dismiss="modal" ng-click="addUser()">Submit</button>
        <button type="button" class="btn btn-danger" data-dismiss="modal">Cancle</button>
      </div>
    </div>

  </div>
</div>
</div>

</body>
</html>
